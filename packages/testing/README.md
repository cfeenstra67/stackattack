# Testing

This package provides utilities for running integration tests on pulumi stacks; there are two primary components:
- The `runIntegrationTest` function - this can be imported from `@stackattack/testing` and allows for setting up and validating single or multi-stack environments. See the [code](./src/index.ts) for full information about arguments or see any of the `infra.spec.ts` files within the [examples](../../examples/) directory for usage examples. It's possible for there to be situations where stacks cannot be torn down cleanly due to configuration issues; there are some environment variables that can be provided to help resolve these situations:
    - `RUN_ID` - This can be used to specify a specific "run id" for this integration test, which can be used to further act upon existing stacks; one common use-case would be running an integration test with `SKIP_DELETE=1` in order to iterate on validation code, storing that run's ID, and repeatedly running again with `RUN_ID=<stored_id> SKIP_DELETE=1` until you're happy with the validation code. Finally, you can then tear down the stack(s) by passing the same `RUN_ID` with `DELETE_ONLY=1` (or alternatively using the `saws-testing delete` CLI tool, though that only acts on a single stack at once).
    - `DELETE_ONLY` - Only run the deletion code--do not create any resources. This can be used for cleaning up stacks after manual intervention.
    - `SKIP_DELETE` - Only run resource creation/updating, do not delete resources when finished.
- The `saws-testing` CLI: this is a CLI that can help as a companion to using `runIntegrationTest`. Currently there is just one sub-command: `delete`. Running `saws-testing delete <stack>` will attempt to refresh + tear down the given stack, unprotecting any resources that are protected within it. This is functionally similar to using `RUN_ID=<some-run-id> DELETE_ONLY=1` with `runIntegrationTests`, but as a standalone command. Note that this command only acts on a single stack at once whereas `DELETE_ONLY=1` will tear down all stacks within the `sourceStacks` argument to `runIntegrationTests`.
